<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Sensor Calibration</title><style>:root{font-family:"Segoe UI",Arial,sans-serif;color-scheme:light dark}*{box-sizing:border-box}body{margin:0;min-height:100vh;background:var(--bg);color:var(--text);transition:background 0.2s ease,color 0.2s ease}body[data-theme="light"]{--bg:#f8fafc;--surface:#ffffff;--text:#1f2933;--muted:#475569;--header-bg:#e2e8f0;--card-border:rgba(15,23,42,0.08);--card-shadow:rgba(15,23,42,0.08);--accent:#2563eb;--accent-strong:#1d4ed8;--accent-contrast:#f8fafc;--chip:#f8fafc;--input-border:#cbd5e1;--danger:#ef4444;--pill-bg:rgba(37,99,235,0.12)}body[data-theme="dark"]{--bg:#0f172a;--surface:#1e293b;--text:#e2e8f0;--muted:#94a3b8;--header-bg:#16213d;--card-border:rgba(15,23,42,0.55);--card-shadow:rgba(0,0,0,0.55);--accent:#38bdf8;--accent-strong:#22d3ee;--accent-contrast:#0f172a;--chip:rgba(148,163,184,0.15);--input-border:rgba(148,163,184,0.4);--danger:#f87171;--pill-bg:rgba(56,189,248,0.18)}header{background:var(--header-bg);padding:28px 24px;box-shadow:0 20px 45px var(--card-shadow)}header .bar{display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap;align-items:flex-start}header h1{margin:0;font-size:1.9rem}header p{margin:8px 0 0;color:var(--muted);max-width:640px;line-height:1.4}.header-actions{display:flex;gap:12px;flex-wrap:wrap;align-items:center}.pill{padding:10px 20px;text-decoration:none;font-weight:600;background:var(--pill-bg);color:var(--accent);border:1px solid transparent;transition:transform 0.15s ease}.pill:hover{transform:translateY(-1px)}.icon-button{width:42px;height:42px;border:1px solid var(--card-border);background:var(--surface);color:var(--text);font-size:1.2rem;cursor:pointer;transition:transform 0.15s ease}.icon-button:hover{transform:translateY(-1px)}main{padding:24px;max-width:1000px;margin:0 auto;width:100%}.card{background:var(--surface);border:1px solid var(--card-border);padding:20px;box-shadow:0 25px 55px var(--card-shadow)}h2{margin-top:0;font-size:1.3rem}h3{margin:20px 0 10px;font-size:1.1rem;border-bottom:1px solid var(--card-border);padding-bottom:6px;color:var(--text)}.field{display:flex;flex-direction:column;margin-bottom:12px}.field span{font-size:0.9rem;color:var(--muted);margin-bottom:4px}.field input,.field select{padding:10px 12px;border:1px solid var(--input-border);font-size:0.95rem;background:var(--bg);color:var(--text)}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}.sensor-card{background:var(--chip);border:1px solid var(--card-border);padding:16px;margin-bottom:16px;position:relative}.sensor-header{display:flex;justify-content:space-between;margin-bottom:12px}.sensor-title{font-weight:600;color:var(--text)}.actions{margin-top:24px;display:flex;gap:12px;flex-wrap:wrap}button{border:none;padding:10px 16px;font-size:0.95rem;font-weight:600;cursor:pointer;background:var(--accent);color:var(--accent-contrast);transition:transform 0.15s ease}button.secondary{background:transparent;border:1px solid var(--card-border);color:var(--text)}button:hover{transform:translateY(-1px)}button:disabled{opacity:0.5;cursor:not-allowed;transform:none}.calibration-step{display:none;}.calibration-step.active{display:block;}.live-reading{font-size:2rem;font-weight:bold;text-align:center;margin:20px 0;color:var(--accent);}.reading-label{text-align:center;color:var(--muted);font-size:0.9rem;}</style></head><body data-theme="light"><header><div class="bar"><div><h1>Sensor Calibration</h1><p> Calibrate 4-20mA sensors and other analog inputs for accurate readings. </p></div><div class="header-actions"><a class="pill secondary" href="/">Dashboard</a><a class="pill secondary" href="/client-console">Client Console</a><a class="pill secondary" href="/config-generator">Config Generator</a><a class="pill secondary" href="/contacts">Contacts</a><a class="pill secondary" href="/serial-monitor">Serial Monitor</a><a class="pill" href="/calibration">Calibration</a><a class="pill secondary" href="/historical">Historical Data</a><a class="pill secondary" href="/server-settings">Server Settings</a></div></div></header><main><div class="card"><h2>Select Sensor to Calibrate</h2><div class="form-grid"><label class="field"><span>Select Client Device</span><select id="clientSelect"><option value="">Loading clients...</option></select></label><label class="field"><span>Select Sensor</span><select id="sensorSelect" disabled><option value="">Select a client first</option></select></label></div><div class="actions"><button id="startCalibrationBtn" disabled>Start Calibration</button></div></div><div id="calibrationInterface" class="card" style="display:none; margin-top: 20px;"><h3>Calibration Wizard: <span id="sensorNameDisplay"></span></h3><div id="step1" class="calibration-step active"><h4>Step 1: Zero Point (Empty Tank / 4mA)</h4><p>Ensure the tank is empty or the sensor is exposed to atmospheric pressure (for pressure sensors).</p><div class="live-reading" id="liveReadingStep1">-- mA</div><div class="reading-label">Current Raw Reading</div><div class="actions"><button id="captureZeroBtn">Capture Zero Point</button></div></div><div id="step2" class="calibration-step"><h4>Step 2: Span Point (Full Tank / 20mA)</h4><p>Ensure the tank is full or apply a known pressure/level.</p><div class="form-grid"><label class="field"><span>Known Value (e.g. 100 inches, 5 PSI)</span><input type="number" id="knownValue" placeholder="Enter known value"></label></div><div class="live-reading" id="liveReadingStep2">-- mA</div><div class="reading-label">Current Raw Reading</div><div class="actions"><button id="captureSpanBtn">Capture Span Point</button><button class="secondary" onclick="showStep(1)">Back</button></div></div><div id="step3" class="calibration-step"><h4>Step 3: Verification</h4><p>Calibration complete. Verify the readings below.</p><div class="live-reading" id="liveReadingStep3">--</div><div class="reading-label">Calibrated Value</div><div class="actions"><button id="saveCalibrationBtn">Save Calibration</button><button class="secondary" onclick="showStep(2)">Back</button></div></div></div></main><script>let clients = [];let selectedClient = null;let selectedSensor = null;let ws = null;function connectWs(){ws = new WebSocket('ws://' + window.location.hostname + '/ws');ws.onmessage = function(event){const data = JSON.parse(event.data);if(data.type === 'live_reading'){updateLiveReading(data.value);}};}function updateLiveReading(value){document.getElementById('liveReadingStep1').textContent = value.toFixed(2) + ' mA';document.getElementById('liveReadingStep2').textContent = value.toFixed(2) + ' mA';// For step 3, we would calculate the calibrated value based on the captured points// This is a placeholder logicconst zero = parseFloat(document.getElementById('liveReadingStep1').dataset.captured || 4);const span = parseFloat(document.getElementById('liveReadingStep2').dataset.captured || 20);const known = parseFloat(document.getElementById('knownValue').value || 100);if(span !== zero){const calibrated = ((value - zero) / (span - zero)) * known;document.getElementById('liveReadingStep3').textContent = calibrated.toFixed(2);}else{document.getElementById('liveReadingStep3').textContent = "Error: Zero and Span are equal";}}function showStep(stepNum){document.querySelectorAll('.calibration-step').forEach(el => el.classList.remove('active'));document.getElementById(`step${stepNum}`).classList.add('active');}document.getElementById('captureZeroBtn').addEventListener('click', () => {const val = parseFloat(document.getElementById('liveReadingStep1').textContent);document.getElementById('liveReadingStep1').dataset.captured = val;showStep(2);});document.getElementById('captureSpanBtn').addEventListener('click', () => {const val = parseFloat(document.getElementById('liveReadingStep2').textContent);document.getElementById('liveReadingStep2').dataset.captured = val;showStep(3);});// Mock data loading - in real implementation this would fetch from serversetTimeout(() => {const clientSelect = document.getElementById('clientSelect');clientSelect.innerHTML = '<option value="client1">Client 1 (Site A)</option><option value="client2">Client 2 (Site B)</option>';document.getElementById('clientSelect').addEventListener('change', (e) => {const sensorSelect = document.getElementById('sensorSelect');if(e.target.value){sensorSelect.disabled = false;sensorSelect.innerHTML = '<option value="s1">Tank 1 Level (4-20mA)</option><option value="s2">Tank 2 Pressure (0-5V)</option>';}else{sensorSelect.disabled = true;sensorSelect.innerHTML = '<option value="">Select a client first</option>';}});document.getElementById('sensorSelect').addEventListener('change', (e) => {document.getElementById('startCalibrationBtn').disabled = !e.target.value;});document.getElementById('startCalibrationBtn').addEventListener('click', () => {document.getElementById('calibrationInterface').style.display = 'block';document.getElementById('sensorNameDisplay').textContent = document.getElementById('sensorSelect').options[document.getElementById('sensorSelect').selectedIndex].text;connectWs();});}, 500);</script></body></html>